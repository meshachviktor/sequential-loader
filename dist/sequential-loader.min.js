/**
 * SequentialLoader v1.0.0
 * Author: Gbemileke Adeleke (https://github.com/meshachviktor)
 * License: MIT
 */
!function(){"use strict";function t(t,e){this.url=t,this._debug=e,this.errorEvent=null,this.stylesheets=null,this.fonts=null,this.scripts=null,this.resourceCount=null,this.batchOrder=null,this.nextBatch=0,this.nextStylesheet=0,this.nextFont=0,this.nextScript=0,this.allStylesheetLoaded=!1,this.allFontsLoaded=!1,this.allScriptsLoaded=!1,this.allResourcesInitialisedEvent=new Event("sl.allresourcesinitialised"),this.fontsLoadedEvent=new Event("sl.fontsloaded"),this.stylesheetsLoadedEvent=new Event("sl.stylesheetsloaded"),this.scriptsLoadedEvent=new Event("sl.scriptsloaded"),this.resourceLoadedEvent=new Event("sl.resourceloaded"),this.allResourcesLoadedEvent=new Event("sl.allresourcesloaded")}t.prototype.toString=function(){return"SequentialLoader"},t.prototype.isArray=function(t){return!!Array.isArray(t)},t.prototype.isEmptyArray=function(t){return 0===t.length},t.prototype.isObject=function(t){return t instanceof Object&&!Array.isArray(t)},t.prototype.isEmptyObject=function(t){return 0===Object.keys(t).length},t.prototype.isJSONString=function(t){try{return JSON.parse(t),!0}catch(t){return!1}},t.prototype.detectError=function(t){this.scripts.some(function(e){return!!new RegExp(e.src).test(t.filename)&&(/SyntaxError/.test(t.message)?(t.preventDefault(),!0):void 0)})&&(this.errorEvent=t)},t.prototype.throwErrorIfErrorDetected=function(){if(this.errorEvent)throw new Error(`Failed to load file ${this.errorEvent.filename}`)},t.prototype.loadStylesheet=function(t){var e=document.createElement("link"),s=Object.keys(t);e.rel="stylesheet";for(let n of s)e[n]=t[n];e.onload=this.loadNextStylesheet.bind(this),document.head.append(e)},t.prototype.loadNextStylesheet=function(){if(document.dispatchEvent(this.resourceLoadedEvent),!(this.nextStylesheet<this.stylesheets.length))return this.allStylesheetLoaded=!0,void document.dispatchEvent(this.stylesheetsLoadedEvent);this.loadStylesheet(this.stylesheets[this.nextStylesheet]),this.nextStylesheet++},t.prototype.beginStylesheetLoading=function(){this.loadStylesheet(this.stylesheets[this.nextStylesheet]),this.nextStylesheet++},t.prototype.loadFont=function(t){let e=null;(e=void 0===t.descriptors?new FontFace(t.family,t.source):new FontFace(t.family,t.source,t.descriptors)).load().then(function(){document.fonts.add(e),this.loadNextFont()}.bind(this)).catch(function(e){throw new Error(`Could not load font from source: ${t.source}`)})},t.prototype.loadNextFont=function(){if(document.dispatchEvent(this.resourceLoadedEvent),!(this.nextFont<this.fonts.length))return this.allFontsLoaded=!0,void document.dispatchEvent(this.fontsLoadedEvent);this.loadFont(this.fonts[this.nextFont]),this.nextFont++},t.prototype.beginFontLoading=function(){this.loadFont(this.fonts[this.nextFont]),this.nextFont++},t.prototype.loadScript=function(t){var e=document.createElement("script"),s=Object.keys(t);for(let n of s)e[n]=t[n];e.onload=this.loadNextScript.bind(this),document.head.append(e)},t.prototype.loadNextScript=function(){if(this.throwErrorIfErrorDetected(),document.dispatchEvent(this.resourceLoadedEvent),!(this.nextScript<this.scripts.length))return this.allScriptsLoaded=!0,void document.dispatchEvent(this.scriptsLoadedEvent);this.loadScript(this.scripts[this.nextScript]),this.nextScript++},t.prototype.beginScriptLoading=function(){this.throwErrorIfErrorDetected(),this.loadScript(this.scripts[this.nextScript]),this.nextScript++},t.prototype.initSylesheetLoading=function(t){if(!this.isArray(t))throw new Error("Stylesheets must be an array!");if(this.isEmptyArray(t))throw new Error("Stylesheets array cannot be empty!");this.stylesheets=t},t.prototype.initScriptLoading=function(t){if(!this.isArray(t))throw new Error("Scripts must be an array!");if(this.isEmptyArray(t))throw new Error("scripts array cannot be empty!");this.scripts=t},t.prototype.initFontLoading=function(t){if(!this.isArray(t))throw new Error("Fonts must be an array!");if(this.isEmptyArray(t))throw new Error("Fonts array cannot be empty!");for(let e=0;e<t.length;e++)if(!this.isObject(t[e]))throw new Error("Invalid font object!");this.fonts=t},t.prototype.processBatch=function(){if(this.nextBatch<this.batchOrder.length){if("fonts"===this.batchOrder[this.nextBatch])this.beginFontLoading();else if("stylesheets"===this.batchOrder[this.nextBatch])this.beginStylesheetLoading();else{if("scripts"!==this.batchOrder[this.nextBatch])throw new Error(`Invalid resource type '${item}'`);this.beginScriptLoading()}this.nextBatch++}else document.dispatchEvent(this.allResourcesLoadedEvent)},t.prototype.initEventHandlers=function(){this._debug&&(document.addEventListener(this.allResourcesLoadedEvent.type,function(){console.log("Sequential loading of all application resources completed.")}),document.addEventListener(this.fontsLoadedEvent.type,function(){console.log("Finished loading all fonts.")}),document.addEventListener(this.stylesheetsLoadedEvent.type,function(){console.log("Finished loading all stylesheets.")}),document.addEventListener(this.scriptsLoadedEvent.type,function(){console.log("Finished loading all scripts.")})),document.addEventListener(this.allResourcesInitialisedEvent.type,this.processBatch.bind(this)),document.addEventListener(this.fontsLoadedEvent.type,this.processBatch.bind(this)),document.addEventListener(this.stylesheetsLoadedEvent.type,this.processBatch.bind(this)),document.addEventListener(this.scriptsLoadedEvent.type,this.processBatch.bind(this)),window.addEventListener("error",this.detectError.bind(this))},t.prototype.initLoading=function(){if(""===this.url||void 0===this.url)throw new Error("Resource list file path is not defined!");if(!this.url.endsWith(".json"))throw new Error("Resource list file path must point to a json document!");this.initEventHandlers(),fetch(this.url).then(function(t){if(t.ok)return t.text();throw new Error("Could not load resource list file.")}).then(function(t){if(!this.isJSONString(t))throw new Error("Content of resources file does not contain a valid json text.");var e=JSON.parse(t);if(void 0===e.fonts&&void 0===e.stylesheets&&void 0===e.scripts)throw new Error("seqentialLoader could not find any resource to load.");if(void 0===e.order){var s=Object.keys(e);this.batchOrder=s}else this.batchOrder=e.order;this.batchOrder.forEach(function(t){if("fonts"===t)this.initFontLoading(e.fonts),this.resourceCount+=this.fonts.length;else if("stylesheets"===t)this.initSylesheetLoading(e.stylesheets),this.resourceCount+=this.stylesheets.length;else{if("scripts"!==t)throw new Error(`Invalid resource type '${t}'`);this.initScriptLoading(e.scripts),this.resourceCount+=this.scripts.length}}.bind(this)),document.dispatchEvent(this.allResourcesInitialisedEvent)}.bind(this))},window.sequentialLoader=new t(document.currentScript.dataset.slResources,"true"===document.currentScript.dataset.slDebug),window.sequentialLoader.initLoading()}();